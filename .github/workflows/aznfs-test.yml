name: Test AZNFS

on:
  workflow_dispatch:
    inputs:
      versionName:
        description: 'Version Name'
        required: true
      storageAccounts:
        description: 'Space-separated Storage Accounts'
        required: true

jobs:
  test_aznfs_ubuntu18:
    name: Test AZNFS - Ubuntu 18
    runs-on: self-hosted-ubuntu18
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
          sudo apt-get install -y build-essential
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_ubuntu20:
    name: Test AZNFS - Ubuntu 20
    runs-on: self-hosted-ubuntu20
    needs: test_aznfs_ubuntu18
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
          sudo apt-get install -y build-essential
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_ubuntu22:
    name: Test AZNFS - Ubuntu 22
    runs-on: self-hosted-ubuntu22
    needs: test_aznfs_ubuntu20
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
          sudo apt-get install -y build-essential
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_centos7:
    name: Test AZNFS - CentOS 7
    runs-on: self-hosted-centos7
    needs: test_aznfs_ubuntu22
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum install -y epel-release
          sudo yum install -y shellcheck
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh
          
  test_aznfs_centos8:
    name: Test AZNFS - CentOS 8
    runs-on: self-hosted-centos8
    needs: test_aznfs_centos7
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum install -y epel-release
          sudo yum install -y shellcheck
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_suse15:
    name: Test AZNFS - openSUSE 15
    runs-on: self-hosted-suse15
    needs: test_aznfs_centos8
    steps:
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_redhat7:
    name: Test AZNFS - Red Hat 7
    runs-on: self-hosted-redhat7
    needs: test_aznfs_suse15
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_redhat8:
    name: Test AZNFS - Red Hat 8
    runs-on: self-hosted-redhat8
    needs: test_aznfs_redhat7
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_redhat9:
    name: Test AZNFS - Red Hat 9
    runs-on: self-hosted-redhat9
    needs: test_aznfs_redhat8
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_rocky8:
    name: Test AZNFS - Rocky Linux 8
    runs-on: self-hosted-rocky8
    needs: test_aznfs_redhat9
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh

  test_aznfs_rocky9:
    name: Test AZNFS - Rocky Linux 9
    runs-on: self-hosted-rocky9
    needs: test_aznfs_rocky8
    steps:
      - name: Install Prerequisites
        shell: bash
        run: |
          sudo yum groupinstall -y "Development Tools"
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh