name: Test AZNFS

on:
  workflow_dispatch:
    inputs:
      versionName:
        description: 'Version Name'
        required: true
      storageAccounts:
        description: 'Space-separated Storage Accounts'
        required: true

jobs:
  test_aznfs:
    name: Test AZNFS
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [self-hosted-ubuntu20, self-hosted-ubuntu22, self-hosted-ubuntu18]

    steps:
      - name: Check Version and Storage Account
        shell: bash
        run: |
          versionName=${{ github.event.inputs.versionName }}
          storageAccounts="${{ github.event.inputs.storageAccounts }}"
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Run Test Script
        shell: bash
        run: |
          export RELEASE_NUMBER=${{ github.event.inputs.versionName }}
          export STORAGE_ACCOUNTS="${{ github.event.inputs.storageAccounts }}"
          chmod +x $GITHUB_WORKSPACE/testing/testscript.sh
          $GITHUB_WORKSPACE/testing/testscript.sh
